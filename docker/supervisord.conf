[supervisord]
nodaemon=true
logfile=/app/logs/supervisord.log
pidfile=/app/temp/supervisord.pid
user=root

[program:ollama]
command=/usr/local/bin/ollama serve
directory=/app
user=root
autostart=true
autorestart=true
stdout_logfile=/app/logs/ollama.log
stderr_logfile=/app/logs/ollama.log
environment=OLLAMA_HOST=0.0.0.0:11434,OLLAMA_ORIGINS=*
priority=10

[program:streamlit]
command=streamlit run ui/dashboard.py --server.port=8501 --server.address=0.0.0.0 --server.headless=true
directory=/app/src
user=appuser
autostart=true
autorestart=true
stdout_logfile=/app/logs/streamlit.log
stderr_logfile=/app/logs/streamlit.log
environment=PYTHONPATH="/app/src",OLLAMA_BASE_URL="http://localhost:11434"
priority=20

[program:health-monitor]
command=python3 -c "
import time
import logging
import subprocess
while True:
    try:
        result = subprocess.run(['curl', '-f', 'http://localhost:8501/_stcore/health'], 
                              capture_output=True, timeout=10)
        if result.returncode == 0:
            logging.info('Health check passed')
        else:
            logging.warning('Health check failed')
    except Exception as e:
        logging.error(f'Health check error: {e}')
    time.sleep(60)
"
directory=/app
user=appuser
autostart=true
autorestart=true
stdout_logfile=/app/logs/health-monitor.log
stderr_logfile=/app/logs/health-monitor.log
